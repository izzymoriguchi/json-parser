
<html>
<head>
    <title>JSON Parser</title>

    <script>
        function viewJSON(what) {
            var URL = what.URL.value;
            function loadJSON(url) {
                if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp = new XMLHttpRequest();
                } else {// code for IE6, IE5
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.open("GET", url, false);
                xmlhttp.send();
                jsonObj = JSON.parse(xmlhttp.responseText);
                return jsonObj;
            }

            jsonObj = loadJSON(URL);

            //if IE, simply execute script (due to async prop).
            if (window.ActiveXObject) {
                if (jsonObj.parseError.errorCode != 0) {
                    var myErr = jsonObj.parseError;
                    generateError(jsonObj);
                    hWin = window.open("", "Error", "height=300,width=340");
                    hWin.document.write(html_text);
                } else {
                    generateHTML(jsonObj);
                    hWin = window.open("", "Assignment3", "height=800,width=600");
                    hWin.document.write(html_text);
                }
            } else { //else if FF, execute script once JSON object has loaded
                jsonObj.onload = generateHTML(jsonObj);
                hWin = window.open("", "Assignment3", "height=800,width=600");
                hWin.document.write(html_text);
            }
            hWin.document.close();
        }

        function generateHTML(jsonObj) {
            root = jsonObj.DocumentElement;
            html_text = "<html><head><title>JSON Parse Result</title></head><body>";
            html_text += "<table border='2'>";

            html_text += "<tbody>";
            html_text += "<tr>";
            x = 0;
            y = 0;

            headerData = jsonObj.Mainline.Table.Header.Data; // an array of header data
            for (i = 0; i < headerData.length; i++) {
                html_text += "<th>" + headerData[i] + "</th>";
            }
            html_text += "</tr>";

            // TODO: output values
            arrOfCompanies = jsonObj.Mainline.Table.Row;
            for(i = 0; i < arrOfCompanies.length; i++) {
                company = arrOfCompanies[i];

                html_text += "<tr>";
                var company_keys = Object.keys(company);
                for(j = 0; j < company_keys.length; j++) {
                    prop = company_keys[j];
                    if(company_keys[j] == "Logo") {//handle images separately
                        // html_text += "<td><img src='" + planeNodeList[prop] + "' width='" + x + "' height='" + y + "'></td>";
                    } else {
                        // console.log("Hello company of "+ i + "th: " + company[prop]);
                        html_text += "<td>" + company[prop] + "</td>";
                    }
                }
                html_text += "</tr>";
            }

            html_text += "</tbody>";
            html_text += "</table>";
            html_text += "</body></html>";
        }

    </script>

</head>
<body>
    <h1>Enter URL for Trucking List JSON File</h1>
    <form name="myform" method="POST" id="location">
        <input type="text" name="URL" maxlength="255" size="100" value="truckinglist.json">
        <br />
        <input type="button" name="submit" value="Submit Query" onclick="viewJSON(this.form)">
    </form>
</body>
</html>